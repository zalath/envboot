<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="index.css" type="text/css" />
    <link rel="stylesheet" href="css/scrollbar.css" type="text/css" />
    <link rel="stylesheet" href="css/left.css" type="text/css" />
    <link rel="stylesheet" href="css/anime.css" type="text/css" />
    <link rel="stylesheet" href="css/right.css" type="text/css" />
    <title></title>
  </head>
  <body>

    <div class="fl left top10">
      <div class="starter st-shadow"></div>
      <div class="starter st" id="starter">
      </div>
    </div>

    <div class="fl middle">
      <div class="fl middlel"></div>
      <div class="fl middlebox">
        <div class="mbtn gy drag"></div>
        <div class="mbtn gy close" onclick="closeapp();"></div>
        <div class="mbtn gy boot" onclick="boot();"></div>
        <ul id='menu' class="menu">
          <li class="mbtn gy" onclick="toggle('starter')">starter</li>
          <li class="mbtn gy" onclick="hi('pm')">pm</li>
          <li class="mbtn gy" onclick="hi('tm')">tm</li>
          <li class="mbtn gy" onclick="hi('task')">task</li>
        </ul>
      </div>
      <div class="fl middler"></div>
    </div>

    <div class="fl right top10">
      <iframe class="face" id="taskw" src=""></iframe>
      <iframe class="face" id="pmw" src=""></iframe>

      <iframe class="face" id="tmw" src=""></iframe>
    </div>

  </body>
  <script>
    window.$ = window.jQuery = require('./jquery-3.4.1.min.js');
    const ipc = require('electron').ipcRenderer;
    function openproject(pname){
      ipc.send('openproject',{path:pname});
    }
    function openpath(pname){
      ipc.send('openpath',{path:pname});
    }
    function closeapp(){
      ipc.send('closeapp',{});
    }
    //init data
    ipc.on('initd',function(event,jda){
      //init project list
      var bodyele = $('.st')[0];
      var body = jda.starter;
      for(let d in body){
        if(body[d] == ''){
          bodyele = add_bar(bodyele);
        }else{
          var b = document.createElement('div');
          b.className = 'btn';
          b.setAttribute('onclick',"openproject('"+body[d].path+"');")
          b.setAttribute('oncontextmenu',"openpath('"+body[d].path+"');")
          b.innerText = body[d].name;
          bodyele.appendChild(b);
        }
      };
      //init menu
      // var menu = jda.menu;
      // var menuele = $('#menu')[0];
      // for(let d in menu){
        // var li = document.createElement('li');
        // li.setAttribute('onclick',"hi('"+menu[d]['id']+"w');");
        // li.innerText = menu[d]['name'];
        // li.className="mbtn gy";
        // menuele.appendChild(li);
      // }
      //pm N tm init
      var url = jda.url;
      var pmele = document.getElementById('pmw');
      var tmele = document.getElementById('tmw');
      var taskele = document.getElementById('taskw');
      pmele.setAttribute('src',url.pm);
      tmele.setAttribute('src',url.tm);
      taskele.setAttribute('src',url.task);
    });
    //switch display
    function hi(id){//hightlight
      $('.face').removeClass('showw');
      $('.face').addClass('hidew');
      $('#'+id+'w').addClass('showw');
    }
    //add an empty line to the list
    function add_bar(body){
      var b = document.createElement('br');
      b.style.clear = 'both';
      var b1 = document.createElement('br');
      b.style.clear = 'both';
      var b2 = document.createElement('br');
      b.style.clear = 'both';
      body.appendChild(b);
      body.appendChild(b1);
      body.appendChild(b2);
      return body;
    }
    //start basic work environment
    function boot(){
      ipc.send('boot',{});
    }
    function toggle(id){
      var ele = $('#'+id);
      if(ele.hasClass('showmenu')){
        ele.addClass('hidemenu');
        ele.removeClass('showmenu');
      }else{
        ele.addClass('showmenu');
        ele.removeClass('hidemenu');
      }
    }
  </script>
</html>
